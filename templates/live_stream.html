{% extends "base.html" %}
{% block title %}Hackney Live Stream{% endblock %}
{% block content %}
<link href="https://vjs.zencdn.net/7.10.2/video-js.min.css" rel="stylesheet">
<h2>Hackney Live Stream</h2>

<!-- Video Player for Live Stream -->
<div class="video-container">
    <video id="live-stream-video" class="video-js vjs-default-skin" controls preload="auto">
        <source src="{{ video_stream_url }}" type="application/x-mpegURL">
    </video>
</div>

<script src="https://vjs.zencdn.net/7.10.2/video.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var player = videojs('live-stream-video');
    player.play();
});
</script>

<!-- Comment Section -->
<div id="comment-section">
    <h3>Comments</h3>
    <ul id="comments">
        {% for comment in comments %}
            <li><strong>{{ comment.username }}:</strong> {{ comment.comment }}</li>
        {% endfor %}
    </ul>
</div>

<!-- Comment Form -->
<form id="comment-form" method="POST">
    {{ form.hidden_tag() }}
    {{ form.comment.label }}<br>
    {{ form.comment(cols=40, rows=3) }}<br>
    {{ form.submit() }}
</form>

<!-- Real-time Chat -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    
    socket.on('connect', function() {
        socket.emit('join', {'room': 'live_stream'});
    });

    socket.on('broadcast_comment', function(data) {
        var comment = '<li><strong>' + data.username + ':</strong> ' + data.comment + '</li>';
        document.getElementById('comments').innerHTML += comment;
    });

    document.getElementById('comment-form').onsubmit = function(e) {
        e.preventDefault();
        var comment = document.getElementById('comment').value;
        socket.emit('new_comment', {'comment': comment});
        document.getElementById('comment').value = '';
    };
});
</script>

{% endblock %}